---
title: "2Assignment3"
---

# Code and Charts
```{r, warning=FALSE, message=FALSE, results='hide'}
# Packages
library(tidycensus)
library(tigris)
library(sf)
library(dplyr)
library(ggplot2)
library(readr)

options(tigris_use_cache = TRUE)

# 1) API key (uncomment and paste your key)
# census_api_key("___", install = TRUE)

# 2) Explore variables
vars <- load_variables(2023, "acs5", cache = TRUE)
# View a few example codes
vars |> dplyr::filter(grepl("^B19", name)) |> dplyr::slice_head(n = 10)

# 3) Parameters (EDIT ME)
state_abbr <- "TX"
geo_level  <- "county"   # options: state, county, tract, block group
my_vars    <- c(hispanic = "B03002_012", pop = "B03001_001", couplehh = "B11012_002")
year_acs   <- 2023
survey     <- "acs5"

# 4) Download
acs <- get_acs(
  geography = geo_level,
  variables = my_vars,
  state = state_abbr,
  year = year_acs,
  survey = survey,
  geometry = TRUE
)

# 5) Wide format for convenience
acs_wide <- acs |>
  tidyr::pivot_wider(
    id_cols = c(GEOID, NAME, geometry),
    names_from = variable,
    values_from = c(estimate, moe)
  )

acs_wide <- acs_wide %>%
  mutate(his_per = estimate_hispanic / estimate_pop)

# 6) Map
ggplot(acs_wide) +
  geom_sf(aes(fill = his_per), color = NA) +
  scale_fill_viridis_c(name = "Hispanic Percentage") +
  labs(title = paste0("ACS ", year_acs, " 5-year: Hispanic Population (%) â€” ", state_abbr, " (", geo_level, ")"),
       caption = "Source: U.S. Census Bureau via tidycensus") +
  theme_minimal()
```

```{r, warning=FALSE, message=FALSE}
# 7) Table
top10 <- acs_wide |>
  arrange(desc(estimate_couplehh)) |>
  select(NAME, estimate_couplehh, moe_couplehh) |>
  slice_head(n = 10)

bottom10 <- acs_wide |>
  arrange(estimate_couplehh) |>
  select(NAME, estimate_couplehh, moe_couplehh) |>
  slice_head(n = 10)

top10
bottom10

# 8) Save outputs (optional)
readr::write_csv(st_drop_geometry(acs_wide), "acs_data_assignment3.csv")

```

# Interpretation

The chloropleth map shows the percentage of hispanics in each county. It is clear that as one moves away from the southern border the less percentage of hispanics there is within each county. The brightest green places are nearest to the border (with as high as 97%) while the darkest blue places are in the east and northeast (plenty less than 10%)

As for the tables, they show the count of married-couple households within each county. Since this is just a count variable with nothing compared to it, it is quite obvious that the most populous counties like Harris, Dallas, Tarrant, and Bexar (housing Houston, Dallas, Fort Worth, and San Antonia respectively) have the most married couple housholds.
